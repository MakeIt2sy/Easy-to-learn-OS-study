# 컴퓨터의 구조와 성능 향상

## 하드웨어의 구성

컴퓨터는 필수장치인 중앙처리장치(CPU), 메인메모리, 주변장치인 입력장치, 출력장치, 저장장치로 구성된다.

### CPU와 메모리

- CPU는 명령어를 해석해서 실행하는 장치, 인간으로 치면 뇌
- 메모리는 작업에 필요한 프로그램과 데이터를 저장하는 장소, 바이트 단위로 분할되어 있으며 분할 공간마다 주소로 구분한다.

### 입출력장치

- 입력장치는 외부의 데이터를 컴퓨터에 입력하는 장치로 키보드,마우스,스마트폰의 터치스크린 등이 있다.
- 출력장치는 컴퓨터에서 처리한 결과를 사용자가 원하는 형태로 출력하는 장치로 프린터, 모니터, 스피커 등이 있다.
- 과거에는 그래픽 계산을 CPU가 담당했는데 최근엔 많은 계산을 필요로 하는 프로그램이 늘어남에 따라 그래픽카드에 GPU가 연산을 담당한다. GPU는 그래픽카드용 CPU이다.

### 저장장치

- 메모리는 전자의 이동으로 데이터를 처리하지만, 하드디스크나 CD와 같은 저장장치는 구동장치가 있는 기계이므로 속도가 느리다.
- 저장장치는 메모리보다 느리지만 저렴하고 용량이 크며 전원 온,오프와 관계없이 데이터를 영구적으로 저장한다.
- 자성을 이용하는 저장장치
  - 카세트테이프, 플로피디스크, 하드디스크
- 레이저를 이용하는 저장장치
  - CD, DVD, 블루레이디스크
- 메모리를 이용하는 저장장치
  - USB 드라이버, SD카드, CF카드, SSD

### 메인보드

- 컴퓨터의 다양한 부품은 버스로 연결된다. 버스는 각 장치를 연결하는 선의 집합이자 데이터가 지나다니는 통로이다.
- 메인보드는 CPU와 메모리등 다양한 부품을 연결하는 커다란 판이다. 전력이 공급되면 버스로 연결된 부품이 작동한다.

<br/>

## 폰노이만 구조

- CPU, 메모리, 입출력장치, 저장장치가 버스로 연결되어있는 구조를 말한다.
- 폰노이만 구조의 가장 큰 특징은 _"모든 프로그램은 메모리에 올라와야 실행할 수 있다."_ 이다.

<br/>

## 하드웨어 사양 관련 용어

### 클럭

- CPU의 속도와 관련된 단위, CPU가 작업을 할 때 일정한 박자가 있는데 이 박자를 만들어내는 것이 클럭이다.

  클럭이 일정 간격으로 틱을 만들면 거기에 맞추어 CPU안에 모든 구성 부품이 작업을 한다. 틱은 펄스 또는 클럭틱이라고 부른다.

### 헤르츠

- 헤르츠는 클럭틱이 발생하는 단위이다. 1초에 클럭틱이 몇 번 발생하는지를 나타낸다.

### 시스템 버스와 CPU 내부 버스

- 시스템 버스 : 메모리와 주변장치를 연결하는 버스로 FSB(Front-Side Bus), 즉 전면 버스라고 한다.

  낮은 속도의 메모리를 연결하면 메인보드가 해당 속도로 작동하여 컴퓨터의 성능이 저하된다.

- CPU 내부 버스 : CPU 내부에 있는 장치를 연결하는 버스로 BSB(Back Side Bus), 즉 후면 버스라고 한다.

  CPU는 CPU 내부 버스의 속도로 작동하고 메모리는 시스템 버스의 속도로 작동하기 때문에 두 버스의 속도 차이로 인해 작엽이 지연되는 문제가 있다.

> 기억 용량 단위

1바이트는 8비트

바이트는 저장장치의 기억 용량을 나타내는 단위 가운데 하나이다. 바이트는 정확히 2^10씩 단위가 올라간다.

- 1B(1바이트) = 1Byte
- 1KB(1킬로바이트) = 2^10Byte
- 1MB(1메가바이트) = 2^20Byte
- 1GB(1기가바이트) = 2^30Byte
- 1TB(1테라바이트) = 2^40Byte

<br />

## CPU와 메모리

<br />

### CPU의 기본 구성

- 산술논리 연산장치 : 데이터의 덧셈, 뺄셈, 곱셈, 나눗셈 같은 산술 연산과 AND, OR 같은 논리 연산을 수행
- 제어장치 : CPU에서 작업을 지시하는 부분
- 레지스터 : CPU 내에 데이터를 임시 저장하는 보관소

### CPU의 명령어 처리 과정

메모리에 저장된 값을 레지스터로 가져오고 연산한 후에 다시 메모리에 할당한다.

```c
  // c언어로 작성한 덧셈 프로그램
  int D2=2, D3=3, sum;
  sum=D2+D3;
```

```c
  // 어셈블리어로 변환한 덧셈 프로그램
  LOAD mem(100), register 2; // 메모리의 100번지(D2)에 있는 값을 레지스터 2로 가져온다.
  LOAD mem(120), register 3; // 메모리의 120번지(D3)에 있는 값을 레지스터 3로 가져온다.
  ADD register 5, register 2, register 3; // 레지스터 2와 레지스터 3에 저장된 값을 더한 결과를 레지스터 5에 넣는다.
  MOVE register 5, mem(160); // 레지스터 5의 값을 메모리의 160번지(sum)로 옮긴다.

```

### 레지스터의 종류

- 데이터 레지스터(DR): 메모리에서 가져온 데이터를 임시로 보관할때 사용, CPU의 레지스터가 대부분 데이터 레지스터이기 때문에 일반 레지스터, 범용 레지스터라고 부른다.
- 주소 레지스터(AR): 데이터 또는 명령어가 저장된 메모리의 주소는 주소 레지스터에 저장된다.

위 두 제리스터는 사용자 프로그램에 의해 변경되기 떄문에 사용자 가시 레지스터(user-visible register)라고 부른다.
데이터 레지스터와 주소 레지스터 외에 특별한 용도로 사용되는 레지스터도 있는데 이를 특수 레지스터라고 한다.
특수 레지스터는 사용자가 임의로 변경할 수 없기 때문에 사용자 불가시 레지스터(user-invisible register)라고 한다.

- 프로그램 카운터(PC): 다음에 실행할 명령어의 주소를 기억하고 있다가 제어장치에게 알려준다, 다음에 실행할 프로그램의 명령어 주소를 가리키기 떄문에 명령어 포인터 라고도 한다.
- 명령어 레지스터(IR): 현재 실행중인 명령어를 저장한다. 제어장치는 명령어 레지스터에 있는 명령을 해석한 후 외부 장치에 적절한 제어 신호를 보낸다.
- 메모리 주소 레지스터(MAR): 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼때 주소를 지정하기 위해 사용한다.
- 메모리 버퍼 레지스터(MBR): 메모리에서 가져온 데이터나 메모리로 옮겨 갈 데이터를 임시로 저장한다.
- 프로그램 상태 레지스터(PSR): 연산결과가 양수인지,음수인지, 0이 아닌지 또는 자리올림의 유무등을 저장한다.

<br />

## 버스의 종류

버스는 CPU와 메모리, 주변장치 간에 데이터를 주고받을 때 사용한다.
|버스|특징|
|----------------|---------------|
|제어 버스| 제어장치와 연결된 버스, CPU가 메모리와 주변장치에 제어 신호를 보내기 위해 사용한다. 메모리와 주변장치에서도 작업이 완료되거나 오류가 발생하면 제어 신호를 보내기 때문에 양방향이다.|
|주소 버스|메모리 주소 레지스터와 연결된 버스로, 메모리나 주변장치에 데이터를 읽거나 쓸 때 위치 정보를 보내기 위해 사용하며 단방향이다.|
|데이터 버스| 메모리 버퍼 레지스터와 연결된 버스로, 데이터의 이동이 양뱡향으로 이루어진다.|

- 버스의 대역폭(bandwidth) : CPU가 한 번에 처리할 수 있는 데이터의 크기

  32bit CPU, 64bit CPU는 메모리에서 데이터를 읽거나 쓸 때 한번에 처리할 수 있는 데이터의 최대 크기를 의미한다.

  버스의 대역폭, 레지스터의 크기, 메모리에 한번에 저장할 수 있는 데이터의 크기는 항상 같다.

  CPU가 한번에 처리할 수 있는 데이터의 최대 크기를 워드(word)라고 한다. 32bit CPU에서 1워드는 32bit이다.

<br />

## 메모리의 종류와 부팅

메모리에는 실행에 필요한 프로그램 데이터가 존재한다.

메모리를 이루는 소자 하나의 크기는 1bit이며 0 또는 1이 저장된다.

소자 하나로는 데이터를 표현할 수 없어서 메모리 주소는 바이트 단위로 지정되고,

메모리에서 데이터를 읽거나 쓸 때는 워드 단위로 움직인다.

<br />

### 메모리의 종류

메모리는 읽기와 쓰기가 가능한 RAM(Random Access Memory)와 읽기만 가능한 ROM(Read Only Memory)로 구분된다.

램은 전력이 끊기면 데이터가 사라지는 휘발성 메모리와 전력이 끊겨도 데이터가 유지되는 비휘발성 메모리로 나뉜다.

<img width="741" alt="KakaoTalk_Photo_2023-01-04-15-53-50" src="https://user-images.githubusercontent.com/103870198/210500193-da15fd92-c7ab-40b9-a8aa-55080e6ac260.png">

### 휘발성 메모리

- 휘발성 메모리에는 DRAM(동적 램)과 SRAM(정적 램)이 있다.

  일반적으로 메인메모리에는 DRAM을 사용하고, 캐시 같은 고속 메모리에는 SRAM을 사용한다.

- DRAM은 저장된 0과 1의 데이터가 일정 시간이 지나면 사라지므로 일정 시간마다 다시 재생시켜아 한다.
- SRAM은 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요가 없다. 따라서 속도는 빠르지만 가격이 비싸다.
- SDRAM은 DRAM이 발전된 형태로 클록틱이 발생할 때마다 데이터를 저장하는 동기 램이다.

<br />

> <h3>DDR SDRAM ❓<h3/><br /> <h4>SDRAM의 대역폭을 늘려 데이터 입출력 속도를 빠르게 한것이 DDR(Double Data Rate) SDRAM이다.

</h4>

<br />

### 비휘발성 메모리

- 플래시 메모리, FRAM, PRAM 등이 있다.
- 플래시 메모리는 디지털카메라, MP3, USB 드라이버같이 전력이 없어도 데이터를 보관하는 저장장치로 사용된다.
- 플래시 메모리의 각 소자는 최대 사용 횟수가 제한되어 있어서 오래 사용하면 성능이 저하되거나 데이터를 잃어버릴 수 있다.
- 이 외에도 많이 사용하는 비휘발성 메모리는 하드디스크를 대신하도록 만든 SSD 이다.

램과 달리 롬은 데이터를 한번 저장하면 바꿀 수 없다.

- Mask ROM: 데이터를 지우거나 쓸 수 없는 롬
- PROM: 전용 기계를 이용하여 데이터를 한 번만 저장할 수 있다.
- EPROM: 데이터를 여러 번 쓰고 지울 수 있다.

<br />

## 메모리 보호

일괄 작업시스템에서는 메모리 보호를 위해 메모리가 운영체제 영역과 사용자 영역으로 구분된다.

메모리를 보호하기 위해 CPU는 현재 진행중인 작업의 메모리 시작 주소를 경계 레지스터에 저장하고

현재 진행중인 작업이 차지하고 있는 메모리의 크기, 즉 마지막 주소까지의 차이를 한계 레지스터에 저장한다.

그리고 사용자의 작업이 진행되는 도앙ㄴ 이 두 레지스터의 주소 범위를 벗어나는지 체크한다.

만약 두 레지스터의 값을 벗어난다면 CPU는 운영체제에게 메모리 오류 인터럽트를 발생시킨다.

<br />

## 부팅

컴퓨터를 켰을 때 운영체제를 메모리에 올리는 과정을 부팅이라고 한다.

1. 사용자가 전원을 켜면 롬에 저장된 바이오스가 실행된다.
2. 바이오스는 CPU, 메모리, 외부 장치가 제대로 작동하는지 확인한다. 이상이 있으면 삐~ 소리와 함께 오류 메세지를 출력하고 이상이 없으면 하드디스크의 마스터 부트 레코드에 저장된 작은 프로그램을 메모리로 가져와 실행한다.
3. MBR은 하드디스크의 첫번째 섹터를 가리키며, 운영체제를 실행하기 위한 코드인 부트스트랩이 이곳에 저장되어 있다.
4. 부스트랩이 메모리에 올라오면 하드디스크에 저장된 운영체제를 메모리로 불러온다.

<br />

# 컴퓨터 성능 향상 기술

## 버퍼(buffer)

속도에 차이가 있는 두 장치 사이에서 그 차이를 완화하는 역할을 한다.

일정량의 데이터를 모았다가 한번에 옮김으로써 속도의 차이를 완화하는 장치가 버퍼이다.

<br />

## 스풀(SPOOL)

스풀은 CPU와 입출력장치가 독립적으로 동작하도록 고안된 소프트웨어적인 버퍼이다. 프린터를 예시로 생각하면 된다.

<br />

## 캐시(cache)

캐시는 메모리와 CPU 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해두는 임시 장소이다.

캐시는 필요한 데이터를 모아 한꺼번에 전달하는 버퍼의 일종이며, 미리 가져오는 작업을 prefetch 라고 한다.

캐시는 CPU 안에 있으며 CPU 내부 버스의 속도로 동작한다. 메모리의 경우 시스템 버스의 속도로 작동하기 떄문에 느린데

CPU와 메모리의 속도차이를 캐시가 완화해준다.

<br />

### 즉시 쓰기와 지연 쓰기

- 즉시쓰기 : 캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 방식
  - 장점: 메모리에 항상 최신값이 유지된다.
  - 단점: 빈번한 데이터 전송으로 성능이 느려진다.
- 지연쓰기: 캐시에 있는 데이터가 변경되면 즉시 반영하는게 아니고 변경된 내용을 모아서 주기적으로 반영하는 방식
  - 장점: 데이터 전송 횟수가 줄어들어 성능을 향상할 수 있다.
  - 단점: 메모리와 캐시된 데이터 사이의 불일치가 발생

<br />

### L1 캐시와 L2 캐시

캐시는 명령어와 데이터 구분없이 모든 자료를 가져오는 일반 캐시와 명령어와 데이터를 구분하여 가져오는 특수 캐시로 나뉜다.

명령어, 데이터 캐시는 각각의 CPU 레지스터와 연결되어 있기 떄문에 L1캐시라고 부르며, 일반 캐시는 메모리와 연결되기 때문에 L2 캐시라고 한다.

## 인터럽트

과거에는 CPU가 직접 입출력장치에 데이터를 가져오거나 내보냈는데 이러한 방식을 폴링 방식이라고 한다.

현재는 효율이 떨어져서 인터럽트 방식을 씀.

CPU가 작업 지시를 내리고 다른 일을 하다가 작업지시 내린쪽에서 다됐는데요 하면 돌아가서 지시 내린 작업을 완료해야 하니까
이처럼 하던 작업을 중단하고 처리해야 하는 신호라는 의미에서 인터럽트라고 불리게 되었다.

### 인터럽트의 동작 과정

1. CPU가 입출력 관리자에게 입출력 명령을 보낸다.
2. 입출력 관리자는 명령받은 데이터를 메모리에 가져다 놓거나 메모리에 있는 데이터를 저장 장치로 옮긴다.
3. 데이터 전송이 완료되면 입출력 관리자는 완료 신호를 CPU에 보낸다.

<br />

### 직접 메모리 접근

입출력 관리자가 CPU 대신 메모리에 접근해서 데이터를 가져놓아야 하는데 권한이 없으므로
이러한 권한을 직접 메모리 접근이라고 한다.

<br />

### 메모리 매핑 입출력

직접 메모리 접근은 CPU가 사용하는 데이터와 입출력 장치가 사요하는 데이터가 섞여 있으므로 복잡해진다.

이를 막기 위해 메모리를 나누어 사용하는 방법이 도입되었다.

CPU가 사용하는 메모리공간과 직접 접근을 통해 사용되는 공간을 분리해놓은것을 메모리 매핑 입출력 이라고 한다.

<br />

### 사이클 훔치기

CPU와 직접메모리접근이 동시에 메모리에 접근하려 하면 CPU가 메모리 사용 권한을 양보하는데 이걸 사이클 훔치기 라고 한다.

<br />

# 병렬 처리

병렬 처리는 동시에 여러 개의 명령을 처리하여 작업의 능률을 올리는 방식을 말한다.

스레드는 CPU가 처리할 수 있는 작업의 단위를 나타내며, 여러 개의 스레드를 동시에 처리하는 방법을

CPU 멀티스레드 라고 한다.

<br />

## 병렬 처리 시 고려 사항

- 상호 의존성이 없어야 병렬 처리가 가능하다.
- 각 단계의 시간을 거의 일정하게 맞춰야 병렬 처리가 원만하게 이루어진다.
- 전체 작업 시간을 몇 단계로 나눌지 잘 따져보아야 한다.

<hr>

Q1. goto 문을 사용하지 말아야 하는 이유?

A. p.103
