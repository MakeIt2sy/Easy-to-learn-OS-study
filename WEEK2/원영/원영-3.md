# 스레드

<br />

## 스레드의 개념

스레드란 프로세스의 코드에 정의된 절차에 따라 CPU에 작업 요청을 하는 실행 단위이다.

<br />

> 작업의 크기

작업을 상대적인 크기순으로 나열하면 처리(job) > 프로세스(task) > 스레드(operation) 이 된다.

여러 개의 스레드가 모여 프로세스를 이루고 여러 개의 프로세스가 모여 처리가 되며, 여러 개의 프로세스를 모아서 한꺼번에 처리하는 방법을 일괄 작업이라고 한다.

<br />

## 스레드 관련 용어

- 멀티스레드 : 프로세스 내 작업을 여러 개의 스레드로 분할함으로써 작업의 부담을 줄이는 프로세스 운영 기법

  - 운영체제가 소프트웨어적으로 프로세스를 작은 단위의 스레드로 분할하여 운영하는 기법

- 멀티태스킹 : 운영체제가 CPU에게 작업을 줄 때 시간을 잘게 나누어 배분하는 기법이다. 이렇게 여러 스레드에 시간을 잘게 나누어주는 시스템을
  시분할 시스템이라고 한다. 시분할 시스템에서 운영체제가 CPU에 전달하는 작업은 프로세스가 아니라 스레드이다.

- 멀티프로세싱 : 하나의 컴퓨터에 여러개의 CPU 혹은 하나의 CPU 내 여러개의 코어에 스레드를 배정하여 동시에 처리하는 작업환경

- CPU 멀티스레드 : 한 번에 하나씩 처리해야 하는 스레드를 파이프라인 기법을 이용하여 동시에 여러 스레드를 처리하도록 만든 병렬 처리 기법

  - 하드웨어적인 방법으로 하나의 CPU에서 여러 스레드를 동시에 처리하는 병렬 처리 기법이다.

  <br />

## 멀티스레드의 구조

![th](https://user-images.githubusercontent.com/103870198/211181712-69932aa7-dbe9-4f81-808a-1c6364ca1252.png)

멀티태스킹 방식으로 워드프로세서를 여러 개 띄워놓고 작업한다고 할 시에 fork() 시스템콜로 프로세스를 여러 개 만들면 코드 일부,PCB, 변수가 메모리 여러 곳에 중복되어 메모리가 낭비된다.

멀티스레드는 fork() 시스템콜 대신 하나의 프로세스에 여러 개의 스레드를 만들어 사용한다. 하나의 프로세스 내에 여러 개의 스레드가 존재하기 때문에 프로세스의 정적 영역을 공유함으로써 자원의 낭비를 막고 효율성을 향상한다.

<br />

## 멀티스레드의 장점

- 응답성 향상 : 한 스레드가 입출력으로 인해 작업이 진행되지 않더라도 다른 스레드가 작업을 계속하여 작업 요구에 빨리 응답할 수 있다.
- 자원 공유 : 한 프로세스 내에서 독립적인 스레드를 생성하면 프로세스가 가진 자원을 모든 스레드가 공유하게 된다.
- 효율성 향상 : 여러 개의 프로세스를 생성하는게 아니라서 자원의 중복을 막음으로써 효율이 향상된다.
- 다중 CPU 지원 : 2개 이상의 CPU를 가진 컴퓨터에서 멀티스레드를 사용하면 다중 CPU가 멀티스레드를 동시 처리하여 프로세스 처리 시간이 단축된다.

<br />

## 멀티스레드의 단점

멸티스레드의 경우 하나의 프로세스 안에 모든 스레드가 자원을 공유하기 때문에 스레드 중 하나에 문제가 생기면 전체 프로세스에 영향을 미친다.
(워드프로세서의 탭을 여러개 띄워놓고 작업하다가 작업중인 탭에서 문제가 생기면 전체 프로그램이 강제 종료되는 것)

<br />

## 멀티스레드 모델

프로세스는 커널 프로세스와 사용자 프로세스로 나뉘며 스레드에도 커널 스레드와 사용자 스레드가 있다.

- 커널 스레드 : 커널이 직접 생성하고 관리하는 스레드
- 사용자 스레드 : 라이브러리에 의해 구현된 일반적인 스레드

### 사용자 스레드(user thread)

- 사용자 레벨에서 라이브러리를 사용해 구현한다.

### 사용자 스레드 장점

- 운영체제에서 스레드를 지원할 필요가 없다
- 스케줄링 결정이나 동기화를 위해 커널을 호출하지 않기 때문에 인터럽트가 발생할 때 커널 레벨 스레드보다 오버헤드가 적다
- 컨텍스트 스위칭이 없다.

### 사용자 레벨 스레드 단점

- 시스템 전반에 걸친 스케줄링 우선순위를 지원하지 않는다.
- 프로세스에 속한 스레드 중 하나라도 블록이 걸리면 전체 스레드가 블록된다.

<br />

## 동적 할당 영역과 시스템 호출

프로세스의 코드 영역, 데이터 영역, 스택 영역 이 있는데 정확히 말하면 힙 영역도 있다.

### 정적 할당 영역

- 코드 영역 : 프로그램의 실행 코드가 있는 곳
- 데이터 영역 : 프로그램이 사용하려고 정의한 변수와 데이터가 있는 곳(포인터를 제외한 일반 변수는 선언할 때 크기가 결정된다)

### 동적 할당 영역

- 스택 영역
  - 호출한 함수가 종료되면 호출하기 전 코드의 메모리 주소를 스택에 저장
  - 지역변수를 저장
- 힙 영역
  - 프로그램이 실행되는 런타임에 할당되는 변수 영역

<br />

## exit() 와 wait() 시스템 호출

- exit() : exit() 함수는 작업의 종료를 알려주는 시스템 호출이다. 인자가 0 이면 정상 종료 -1이면 비정상 종료
- wait() : 부모프로세스는 자식 프로세스가 종료되었는지 여부를 체크할 필요가 있는데, wait 함수를 사용하면 부모 자식의 종료시점이 서로 동기화하는 방식으로 작동한다.

q1. 멀티스레드의 단점과 멀티태스킹의 장점
