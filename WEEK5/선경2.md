-----

Chapter08. 가상 메모리의 기초

-----  

### 01. 가상 메모리의 개요
#### 가상메모리란?
메모리 관리 기법 중 하나로 물리 메모리의 크기와 상관없이  
프로세스에 커다란 메모리 공간을 제공하는 기법  
각 프로그램에 실제 메모리 주소가 아닌 가상의 메모리 주소를 줌

#### 가상 메모리의 크기
컴퓨터 시스템이 가진 물리 메모리의 최대 크기로 한정되며,
CPU의 비트에 따라 결정됨  
그러나 이론적으로는 스왑영역을 활용하기 때문에 때문에 무한대의 크기  
따라서 가상 메모리에서 메모리 관리자가 사용할 수 있는 메모리의 전체 크기는  
물리 메모리(실제 메모리)와 스왑 영역을 합한 크기  

#### 스왑 영역
리눅스에서 물리적 메모리의 용량이 가득 차게될 경우 사용되는 여유 공간

#### 매핑 테이블  
메모리를 관리할 때, 가상 메모리 시스템에서 가상 주소는 실제로 물리 주소나 스왑 영역 중  
한 곳에 위치하는데 메모리 관리자가 메모리에서 가상 주소의 위치를 알 수 있도록  
일대일 매핑으로 관리하는 테이블  

* 페이지 매핑 테이블 : 페이징 기법에서 사용하는 매핑 테이블  
* 세그먼테이션 매핑 테이블 : 세그먼테이션 기법에서 사용하는 매핑 테이블


### 02. 페이징 기법
가상 메모리의 메모리 분할 방식으로 고정 분할 방식  
물리 주소 공간을 같은 크기로 나누어 사용  
#### 페이지  
가상 주소의 분할된 각 영역으로 0부터 번호를 매겨 관리  
물리 메모리의 프레임과 크기가 같기 때문에 어떤 프레임에도 배치될 수 있음  

#### 페이지 테이블 관리  
* 시스템에 여러 개의 프로세스가 존재하고 프로세스마다 페이지 테이블이 하나씩 있기 때문에 관리가 복잡함  
* 메모리 관리자가 자주 사용하는 자료 구조이므로 필요시 빨리 접근할 수 있어야 하기 때문에  
  물리 메모리 영역 중 운영체제 영역의 일부분에 모아놓음  
* 페이지 테이블의 위치를 빠르게 파악하기 위해  
  각 페이지 테이블의 시작 주소를 페이지 테이블 기준 레지스터에 보관
* 페이지 테이블의 크기는 프로세스의 수와 비례하기 때문에  
  적정 크기를 유지하는 것이 관리의 핵심  

#### 페이지 테이블 매핑 방식  
* 직접 매핑 :  
  페이지 테이블 전체가 물리 메모리의 운영체제 영역에 존재하는 방식  
  별다른 부가 작업 없이 바로 주소 변환 가능  
* 연관 매핑 :  
  페이지 테이블 전체를 스왑 영역에서 관리하는 방식  
  일부 내용만 무작위로 배치하기 때문에 페이지 번호와 프레임 번호 둘 다 표시  
  전체 페이지를 물리 메모리에 보관하지 않아 메모리를 절약할 수 있음  
  주소 변환 시 물리 메모리 내의 페이지 테이블을 모두 검색하고  
  만약 원하는 프레임 번호를 얻지 못한다면 스왑 영역에 있는 페이지 테이블을 검색해야 한다는 문제가 있음  
  * 연관 레지스터 :  
    페이지 번호와 프레임 번호로 구성된 작은 크기의 테이블
* 집합-연관 매핑 :  
  연관 매핑의 문제를 개선한 방식으로 페이지 테이블을 일정한 집합으로 자르고,  
  자른 덩어리 단위로 물리 메모리에 가져옴  
  물리 메모리의 모든 페이지 테이블을 검사할 필요가 없기 때문에 주소 변환 시간이 단축됨
* 역매핑 :  
  페이지 테이블을 구성하는 방식  
  물리 메모리의 프레임 번호를 기준으로 테이블을 구성  
  프로세스의 수와 상관없이 테이블이 하나만 존재하기 때문에 테이블의 크기가 매우 작다는 장점이 있음  
  그러나 가상 메모리에 접근할 때 프로세스 아이디와 페이지 번호를  
  모두 찾아야 하는 단점이 있음

### 03. 세그먼테이션 기법
가상 메모리의 메모리 분할 방식으로 가변 분할 방식  
프로세스의 크기에 따라 메모리를 분할하기 때문에 매핑 테이블에 크기 정보를 포함함  
메모리를 프로세스 단위로 관리하기 때문에 페이지 테이블이 작고 단순  
그러나 물리 메모리의 외부 단편화로 인해 물리 메모리 관리가 복잡  

### 04. 세그먼테이션-페이지 혼용 기법  
현재 대부분의 운영체제에서 사용하는 기법  

#### 메모리 접근 권한  
읽기, 쓰기, 실행, 추가 권한이 있음  
코드 영역은 읽기 및 실행 권한을 가지고,  
데이터 영역에서 데이터는 읽거나 쓸 수 있는 데이터, 읽기만 가능한 데이터로 나눠지는데  
일반적인 변수는 읽기 및 쓰기 권한을 가지고,  
상수로 선언한 변수는 읽기 권한만 가짐  
권한 검사는 가상 주소에서 물리 주소로 주소 변환이 일어날 때마다 시행됨  

#### 도입 이유  
페이지마다 접근 권한이 다르기 때문에 페이지 테이블의 모든 행에는 메모리 접근 권한과  
관련된 **권한 비트**가 추가됨  
메모리 관리자는 주소 변환이 이루어질 대마다 페이지 테이블의 권한 비트를 이용하여  
유용한 접근인지 확인  
페이지 테이블에 권한 비트가 추가되면 테이블의 크기가 커지게 되고  
메모리를 낭비하는 요소가 됨  
이 문제를 완화하기 위해 권한 비트 추가에 따라 세그먼테이션 테이블을 사용하여 해결


### 예상 질문
* 운영체제는 프로세스를 메모리로 올릴 때 메모리 관리를 어떻게 하나요?
* 가상 메모리가 무엇인가요?
* 페이징이 무엇인가요?
* 페이징 기법에서 문제점은 무엇인가요?
* 세그먼테이션이 무엇인가요?
* 세그먼테이션의 단점이 있나요?

### 참고  
[가상 메모리](https://ko.wikipedia.org/wiki/%EA%B0%80%EC%83%81_%EB%A9%94%EB%AA%A8%EB%A6%AC)  
[Red Hat Linux 9: Red Hat Linux 사용자 정의 가이드](http://coffeenix.net/doc/RH-DOCS/rhl-cg-ko-9/ch-swapspace.html)  
[가상 메모리 개요](https://velog.io/@chappi/OS%EB%8A%94-%ED%95%A0%EA%BB%80%EB%8D%B0-%ED%95%B5%EC%8B%AC%EB%A7%8C-%ED%95%A9%EB%8B%88%EB%8B%A4.-14%ED%8E%B8-%EA%B0%80%EC%83%81-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B0%9C%EC%9A%94-%ED%8E%98%EC%9D%B4%EC%A7%95)  
[[운영체제(OS)] 가상 메모리 - (2) 세그멘테이션 기법과 세그멘테이션-페이징 혼용 기법](https://kjhoon0330.tistory.com/entry/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9COS-%EA%B0%80%EC%83%81-%EB%A9%94%EB%AA%A8%EB%A6%AC-2-%EC%84%B8%EA%B7%B8%EB%A9%98%ED%85%8C%EC%9D%B4%EC%85%98-%EA%B8%B0%EB%B2%95%EA%B3%BC-%EC%84%B8%EA%B7%B8%EB%A9%98%ED%85%8C%EC%9D%B4%EC%85%98-%ED%8E%98%EC%9D%B4%EC%A7%95-%ED%98%BC%EC%9A%A9-%EA%B8%B0%EB%B2%95)  
[프로세스,스레드,동기화 문제,교착상태,페이징,가상메모리](https://onejunu.tistory.com/159)

