# 물리 메모리

---

# Q&A

- 내부 단편화와, 외부 단편화에 대해 설명
- 세그먼테이션-페이징 혼용기법에서 접근 권한을 어디에서 확인할 수 있나요

---

오늘날의 시분할 시스템에서는 운영체제를 포함한 모든 프로세스가 메모리에 올라와야 실행되기 때문에, 한정된 크기를 가진 메모리를 관리하는 것이 중요하다

# 메모리 관리자(MMU)의 역할

 

메모리 관리는 메모리 관리자가 담당한다.

크게 3가지 작업

1. fetch(가져오기):
    - 프로세스와 데이터를 메모리로 가져오는 작업
2. placement(배치)
    - 가져온 프로세스와 데이터를 메모리의 어떤 부분에 올려놓을지 결정하는 작업
3. replacement(재배치)
    - 새로운 프로세스를 가져와야 하는데 메모리가 차있다면 어떤 프로세스를 하드디스크로 옮기는 작업

---

# 메모리 주소

32비트 CPU는 한번에 다룰 수 있는 데이터의 최대 크기가 32비트

64비트 CPU는 한번에 다룰 수 있는 데이터의 최대 크기가 64비트

CPU 모든 부품(레지스터,버스의 대역폭, 옮겨지는 데이터의 크기)은 이 비트를 기준으로 동작

### 절대주소와 상대주소

- 절대주소: 실제 물리 주소를 가리키며 메모리 관리자에서 바라본 주소
- 상대주소: 사용자 영역이 시작되는 주소를 0번지로 변경하여 사용하는 주소

---

# 메모리 할당

### 메모리 오버레이 기법

- 프로그램의 크기가 실제 메모리보다 클 때 전체 프로그램을 메모리에 가져오는 대신 적당한 크기(모듈화)로 잘려서 가져오는 기법

### 스왑 영역

- 메모리 공간이 부족하여 쫓겨난 프로세스가 저장되는 저장장치의 특별한 공간
- 스왑 영역은 메모리 관리자가 관리한다
- 저장 장치는 장소만 빌려주고 메모리 관리자가 관리한다.
- 스왑을 이용하면 스왑 영역의 크기가 메모리의 크기로 인식된다
- 메모리 → 하드디스크(스왑영역) : 스왑인
- 메모리 ← 하드디스크(스왑영역) : 스왑아웃

---

# 메모리 분할 방식

물리 메모리 공간을 분할하는 방식으로는 두가지 방식이 존재한다.

1. 가변 분할: 프로세스의 크기에 따라 메모리를 나누는 방식
2. 고정 분할: 프로세스의 크기와 상관없이 메모리를 같은 크기로 나누는 방식

## 고정 분할 방식(비연속 메모리 할당)

- 한 프로세스가 분산되어 배치되는 방식
- 주어진 개수 만큼의 영구적인 분할로 미리 나누어 두고 각 분할에 하나의 프로그램을 적재하는 방식
    - 이 분할의 크기를 모두 동일하게 할 수도 있고 서로 다르게 할 수도 있습니다.
- 하나의 분할에는 하나의 프로그램만 적재 가능하므로 **외부 조각**과 **내부 조각**이 발생함
    - 외부 조각
        - **프로그램의 크기 > 분할의 크기**인 경우 발생
        - 프로그램을 적재하지 못하는 빈 메모리 공간으로 사용될 수 없는 작은 분할을 의미
    - 내부 조각
        - **프로그램의 크기 < 분할의 크기**인 경우 발생
        - 프로그램이 분할에 적재되고 나서 분할 내부에 사용될 수 없는 메모리 조각을 의미

![Screenshot 2023-01-25 at 7.46.09 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0d52d322-f647-4f04-b2af-79bb5ddf5484/Screenshot_2023-01-25_at_7.46.09_PM.png)

### 장점

- 메모리 통합 같은 부가적인 작업이 필요없다

### 단점

- 단편화로 인한 메모리 낭비 발생

## 가변 분할  방식(연속 메모리 할당)

- 한 프로세스가 연속된 공간에 배치되는 방식
- 메모리에 적재되는 프로세스 크기에 따라 분할의 크기, 개수가 동적으로 변하는 방식
- 가변 분할 방식에서 프로세스의 크기보다 분할의 크기보다 크게 할당하기 때문에 **내부 조각**은 발생하지 않습니다.
- 하지만 이미 메모리에 존재하는 프로그램이 종료되고,메모리 크기보다 더 작은 크기의 새로운 프로세스가 할당될 때 **외부 조각**이 발생할 수 있다.
- 또한, 프로세스를 어떤 위치에 올릴지 결정하기 위한 **동적 메모리 할당 문제**가 있다.

![Screenshot 2023-01-25 at 7.41.08 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/82aae7be-0400-4b13-ba4c-fce18b8f87af/Screenshot_2023-01-25_at_7.41.08_PM.png)

### 장점

- 프로세스를 한 덩어리로 처리하여 하나의 프로세스를 연속된 공간에 배치한다.

### 단점

- 메모리 관리가 복잡하다.
- 메모리 통합 등의 부가적인 작업이 필요하다.

---

## 외부 단편화 문제 해결

### 1. 메모리 배치 방식

- 최초 적합 방법(first-fit)
    - 가용 공간을 차례대로 살펴보면서 **프로그램 크기 < 가용 공간 크기**가 최초로 발견될 때, 해당 프로세스 할당한다.
    - 모든 가용 공간을 탐색하지 않아 시간적인 측면에서 효율적
- 최적 적합 방법(best-fit)
    - **프로세스 크기 < 가용 공간 크기**인 **가장 작은 공간**을 찾고 프로세스를 할당합니다.
    - 모든 가용 공간 리스트가 크기 순으로 정렬되어 있지 않으면, 모든 가용 리스트를 탐색해야하는 오버헤드가 발생한다.
- 최악 적합 방법(worst-fit)
    - **프로세스 크기 < 가용 공간 크기**인 **가장 큰 공간**을 찾고 프로세스를 할당합니다.
    - 모든 가용 공간 리스트가 크기 순으로 정렬되어 있지 않으면, 모든 가용 리스트를 탐색해야하는 오버헤드가 발생한다.

### 2. 조각 모음

- 서로 떨어져 있는 여러 개의 빈 공간을 합치는 작업
- 조각 모음을 하려면 프로세스를 중지시키고,이동하고,주소를 바꾸고,다시 시작하는 작업을 해야하기 때문에 많은 시간 소요