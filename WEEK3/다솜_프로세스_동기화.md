# CHAPTER 05 프로세스 동기화

# 프로세스 간 통신

- 프로세스가 다른 프로세스와 데이터를 주고받는 것
- IPC라고도 한다.
- 컴퓨터 내에 있는 프로세스뿐 아니라 네트워크로 연결된 다른 컴퓨터에 있는 프로세스와의 통신도 포함된다.
- 읽기와 쓰기 연산으로 구현한다.

## 데이터의 위치에 따른 분류

### 프로세스 내부 데이터 통신

하나의 프로세스 내에 2개 이상의 스레드가 존재하는 경우, 프로세스 내부의 스레드는 전역 변수나 파일을 이용하여 데이터를 주고 받는다.

### 같은 컴퓨터에 있는 프로세스 간 데이터 통신

같은 컴퓨터에 있는 여러 프로세스끼리 통신하는 경우, 공용 파일 또는 운영체제가 제공하는 파이프를 사용하여 통신한다.

### 네트워크를 이용한 데이터 통신

여러 컴퓨터가 네트워크에 연결되어 있을 경우, 소켓을 이용하여 통신한다.

## 통신 방향에 따른 분류

### 양방향 통신

데이터를 동시에 양쪽 방향으로 전송할 수 있다. 소켓 통신이 이에 해당한다.

### 반양방향 통신

데이터를 양쪽 방향으로 전송할 수 있지만, 동시 전송은 불가능하고, 특정 시점에 한쪽 방향으로만 전송할 수 있다. 무전기가 이에 해당한다.

### 단방향 통신

한쪽 방향으로만 데이터를 전송할 수 있는 구조이다. 전역 변수, 파일, 파이프가 이에 해당한다.

## 통신 구현 방식에 따른 분류

### 대기가 있는 통신

동기화를 지원한다. 요청한 데이터가 도착할 때까지 자동으로 대기 상태에 머무른다. 소켓, 파이프가 이에 해당한다.

### 대기가 없는 통신

동기화를 지원하지 않는다.   바쁜 대기를 사용하여 데이터가 도착했는지 여부를 직접 확인한다. 이러한 통신 방식을 가진 예로는 전역 변수, 파일이 있다.

## 프로세스 간 통신의 종류

### 공유 메모리

프로세스들이 **주소 공간의 일부를 공유**하여 공유한 메모리 영역에 읽기/쓰기를 해서 통신을 수행한다. 즉, **프로세스간 메모리 영역을 공유**한다. 프로세스가 공유 메모리 할당을 커널에 요청하면 커널은 해당 프로세스에게 메모리 공간을 할당해 준다. 공유 메모리 영역이 구축된 이후에는 모든 접근이 일반적인 메모리 접근으로 취급되어 더 이상 **커널의 도움 없이도 각 프로세스들이 공유 메모리 영역에 접근할 수 있다.**

### 특징

- 초기에 공유 메모리 영역을 구축한 이후로는 커널의 관여 없이 데이터 통신이 가능하기 때문에 속도가 빠르다.
- 운영체제가 동기화를 지원하지 않는다.
- 동시에 같은 메모리 위치에 접근할 경우, 일관성 문제가 발생할 가능성이 있다.
-> 이에 대해 커널이 관여하지 않기 때문에 프로세스들끼리 직접 공유 메모리 접근에 대한 동기화 문제를 책임져야 한다.

### 전역 변수 이용

- 공동으로 관리하는 메모리를 사용해 데이터를 주고받는다.
- 데이터를 보내는 쪽에서는 전역 변수나 파일에 값을 쓰고, 받는 쪽에서는 전역 변수의 값을 읽는다.
- 직접적으로 관련이 있는 프로세스간에 사용한다.
- 부모 프로세스가 전역 변수를 선언한 다음 자식 프로세스를 만든다고 가정해 보자. 이렇게 하면 전역 변수를 통해 부모 프로세스와 자식 프로세스가 통신을 할 수 있게 된다. 이 전역 변수는 부모 프로세스와 자식 프로세스가 공유하는 메모리 영역에 위치한다. 두 프로세스는 전역 변수에 읽기 또는 쓰기 연산을 한다.
→ 상대 프로세스가 언제 전역 변수에 데이터를 쓸지 알 수 없기 때문에 계속해서 전역 변수의 값을 확인해야 한다. 즉, 전역 변수의 값이 변할 때까지 바쁜 대기를 한다.

### 파일 이용

- 부모-자식 관계 프로세스 간 통신에 많이 사용된다.
- 주로 부모 프로세스가 wait() 함수를 이용하여 자식 프로세스의 작업이 끝날 때까지 기다렸다가 작업을 시작한다.

### 메시지 전달

통상 시스템 콜을 이용하여 구현된다. 커널을 통해 send(message)와 receive(message) 연산을 제공받는다. 예를 들어 프로세스 A 가 커널에 메시지를 보내면 커널이 프로세스
B 에게 그 메시지를 보내주는 방식이다.

### 특징

- 시스템 콜을 사용하기 때문에 커널의 관여를 받아 속도가 느리다.
- 충돌을 회피할 필요가 없어 적은 양의 데이터를 교환하는 데 유리하다.
- 운영체제가 동기화 방식을 제공하므로 구현하기 쉽다.
- 프로세스 동기화를 지원하므로 바쁜 대기를 하지 않는다.

### 파이프 이용

- 운영체제가 제공하는 동기화 통신 방식
- 단방향 통신. 양쪽 모두 송/수신을 하고 싶으면 2개의 파이프가 필요하다.
- 만약 프로세스 B가 파이프 1에 대해 읽기 연산을 수행했는데 프로세스 A가 아직 파이프 1에 쓰기 연산을 수행하지 않았다면, 프로세스 B는 대기 상태가 된다. 프로세스 A가 파이프 1에 쓰기 연산을 수행하는 순간 자동으로 프로세스 B의 대기 상태가 풀려 동기화가 이루어진다. 즉, 대기 상태 덕분에 프로세스 B는 바쁜 대기를 하지 않는다.
- **이름 없는 파이프**
통신할 프로세스를 명확히 알 수 있는 경우에 사용한다.
부모와 자식 프로세스, 같은 부모를 가진 자식 프로세스와 같이 서로 관련 있는 프로세스 간 통신에 사용된다.
- **이름 있는 파이프**
이름 없는 파이프의 확장 상태이며, 서로 관련 없는 프로세스 간 통신에 사용된다.
****FIFO라 불리는 특수 파일을 이용한다.

### 메시지 큐 이용

- 입출력 방식은 이름 있는 파이프와 동일하다.
- 데이터의 흐름이 아닌 메모리 공간이다.
- 사용할 데이터에 번호를 붙여 여러 프로세스가 동시에 데이터를 쉽게 다룰 수 있다.

### 소켓 이용

- 여러 컴퓨터에 있는 프로세스끼리의 통신 방식으로, 원격에서 프로세스 간 데이터를 공유할 때 사용한다.
- 클라이언트와 서버가 소켓을 통해서 통신하는 구조
- 양방향 통신
- 통신하고자 하는 프로세스는 소켓에 쓰기 연산을 해서 데이터를 전송하거나, 읽기 연산을 해서 데이터를 받는다.

# 공유 자원과 임계구역

## Race Condition(경쟁 조건)

2개 이상의 스레드가 공유 자원을 병행적으로 읽거나 써서, **공유 자원의 값이 꼬이게 되는** 문제

**예시**

- [입출금 문제](https://ko.wikipedia.org/wiki/%EC%9E%85%EC%B6%9C%EA%B8%88_%EB%AC%B8%EC%A0%9C)
- [생산자-소비자 문제](https://ko.wikipedia.org/wiki/%EC%83%9D%EC%82%B0%EC%9E%90-%EC%86%8C%EB%B9%84%EC%9E%90_%EB%AC%B8%EC%A0%9C)

예시들과 같은 상황을 방지하기 위해, 스레드 여러 개가 하나의 공유 자원을 변경해야 할 때는, 다른 스레드가 접근중인 자원에는 접근하면 안 된다. 이를 위한 방법이 임계구역이다.

## Critical Section(임계구역)

경쟁 조건의 해결법이다. 공유 자원의 일관성을 유지하기 위해 공유 자원에 접근하는 코드 부분을 임계 구역으로 지정한다. 임계구역은 공유 자원 접근 순서에 따라 실행 결과가 달라지는 프로그램의 영역으로, 임계구역에는 한 번에 하나의 스레드만이 들어갈 수 있다.

### 임계구역이 갖춰야 할 3가지 조건

- 상호 배제: 한 프로세스가 임계구역에 들어가면 다른 프로세스는 임계구역에 들어갈 수 없다.
- 한정 대기: 어떤 프로세스도 무한히 대기해서는 안된다. 즉, 특정 프로세스가 임계구역에 진입하지 못하면 안된다.
- 진행의 융통성: 한 프로세스가 다른 프로세스의 진행을 방해해서는 안된다.

# 임계구역 해결 방법

참고: [https://hoyeonkim795.github.io/posts/mutex-semaphore/](https://hoyeonkim795.github.io/posts/mutex-semaphore/)

## 뮤텍스

제어되는 섹션에 하나의 스레드만 허용한다. 해당 섹션에 접근하려는 다른 스레드를 강제적으로 막는다.

### 피터슨

### 데커

### 베이커리

## 세마포어

## 모니터

# 파일, 파이프, 소켓 프로그래밍

# 질문 목록

## 연습문제

### 

## 그 외 질문

###