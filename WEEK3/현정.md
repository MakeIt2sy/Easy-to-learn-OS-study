# CPU 스케줄링

## 1. 스케줄링의 개요 
<br/>

CPU스케줄러는 프로세스의 생성부터 종료까지 모든 상태 변화를 조정하는 일을 한다. 
<br/>

### [스케줄링의 단계]
<br/>

- 고수준 스케줄링
  - 가장 큰 틀에서 이루어지는 CPU 스케줄링. 시스템 내의 전체 작업 수를 조절하는 것을 말한다.    
  - 고수준 스케줄링 단계에서는 시스템 부하를 고려하여 어떤 작업을 받아들일지 거부할지를 결정한다. 
- 저수준 스케줄링
  - 어떤 프로세스를 CPU에 할당할지, 대기상태로 보낼지 등을 결정하는 스케줄링
  - 오늘날 CPU 스케줄러는 대부분 중간수준과 저수준 스케줄링으로 구성되어 있다. 
- 중간수준 스케줄링
  - 고수준 스케줄링과 저수준 스케줄링 사이에 일어나는 스케줄링
  - 시스템의 과부하 상황에서 프로세스 수를 조절해야할 때, 이미 활성화된 프로세스 일부를 보류 상태로 보내고 여유가 생기면 다시 활성화시킨다. 

<br/>

### [스케줄링의 목적]
<br/>

- 공평성: 모든 프로세스는 자원을 공평하게 배정받아야하고 특정 프로세스가 배제되어서는 안된다.
- 효율성: 시스템 자원이 유휴 시간 없이 사용되도록 스케줄링해야한다. 
- 안정성: 우선 순위를 사용하여 중요 프로세스가 먼저 작동하도록 배정함으로써 시스템 자원을 점유하거나 파괴하려는 프로세스로부터 자원을 보호한다.
- 확장성: 프로세스가 증가해도 시스템이 안정적으로 작동하도록 조치해야한다.
- 반응 시간 보장: 적절한 시간 안에 프로세스의 요구에 반응해야한다.
- 무한 연기 방지: 특정 프로세스의 작업이 무한히 연기되어서는 안된다.

<br/>

## 2. 스케줄링 시 고려 사항
<br/>

### [선점형 스케줄링과 비선점형 스케줄링]
<br/>

- 선점형 스케줄링: 어떤 프로세스가 CPU를 할당받아서 실행 중이더라도 운영체제가 CPU를 강제로 빼앗을 수 있는 스케줄링 방식
  - 대부분 저수준 스케줄러는 선점형 스케줄링 방식을 사용한다. 
  - 컨텍스트 스위칭이 자주 일어나 자원 낭비가 생긴다.
- 비선점형 스케줄링: 어떤 프로세스가 CPU를 할당받으면 다른 프로세스가 이를 빼앗을 수 없는 스케줄링 방식
  - 과거 일괄 작업 시스템에서 사용하던 방식이다.
  - 기다리는 프로세스가 많아 처리율이 떨어진다.

<br/>

### [우선순위]
<br/>

 대부분의 CPU 스케줄러는 우선순위를 사용한다. 프로세스의 중요도에 따라 더 빨리, 자주 실행될 프로세스를 결정하는 것이다. 

<br/>

### [CPU 집중 프로세스와 입출력 집중 프로세스]
<br/>

- CPU집중 프로세스: 수학 연산과 같이 CPU를 많이 사용하는 프로세스를 말한다.
- 입출력 집중 프로세스: 입출력 버스트가 많은 프로세스를 말한다.

둘이 같이 있을 때에는 입출력 집중 프로세스를 먼저 실행 상태로 옮기는 것이 효율적이다. 입출력 집중 프로세스는 입출력 요구에 의해 대기 상태로 옮겨지기 때문에 다른 프로세스가 CPU를 사용할 수 있기 때문이다.

<br/>

### [전면 프로세스와 후면 프로세스]
<br/>

- 전면 프로세스 : GUI를 사용하는 운영체제에서 화면의 맨 앞에 놓인 프로세스를 말한다. 현재 입출력을 사용하는 프로세스, 사용자와 상호작용을 하고 있는 프로세스이다.
- 후면 프로세스 : 사용자와 상호작용이 없는 프로세스이다.사용자의 입력 없이 작동하기 때문에 일괄 작업 프로세스라고도 한다.
  
 전면 프로세스는 사용자의 요구에 즉각 반응해야하지만 후면 프로세스는 상호작용이 없다. 따라서 전면 프로세스의 우선순위가 더 높다. 

<br/>

### [정리]
<br/>

 우선 순위가 높은 프로세스는 커널 프로세스, 전면 프로세스, 입출력 집중 프로세스이다. 반면 우선 순위가 낮은 프로세스는 일반 프로세스, 후면 프로세스, 일괄작업 프로세스, CPU집중 프로세스이다. 

<br/>

## 3. 다중 큐
<br/>

### [준비 상태의 다중 큐]
<br/>

  프로세스의 중요도에 따라 우선 순위를 만들고 우선 순위 별로 여러 개의 준비 상태 큐가 만들어진다.  

  - 고정 우선순위 방식: 운영체제가 프로세스에 우선순위를 부여하면 프로세스가 끝날 때까지 바뀌지 않는 방식이다. 구현하기에는 쉽지만 시스템 상황이 계속 변하는데 우선순위를 고정하면 시스템 변화에 대응하기가 어려워 작업 효율이 떨어진다.
  - 변동 우선순위 방식: 프로세스 생성 시 부여받은 우선순위가 프로세스 작업 중간에 변하는 방식이다. 구현하기 어렵지만 시스템 효율성을 높일 수 있다. 

<br/>

### [대기 상태의 다중 큐]
<br/>

 여러 개의 입출력 장치가 있기 때문에 대기 상태 프로세스를 한 곳에 모아놓으면 관리하기가 불편하다. 따라서 대기 상태에서도 다중 큐를 사용한다.같은 장치의 입출력을 기다리는 프로세스의 프로세스 제어 블록은 동일한 입출력 큐에 모여 있다가 인터럽트가 도착하면 프로세스 제어블록 상태가 준비 상태로 바뀌고 준비 큐로 이동한다.  
 대기 상태의 다중 큐는 준비 상태의 다중 큐와 차이가 있다. 준비 큐는 하나의 프로세스를 꺼내어 cpu를 할당하는 반면, 대기 큐는 여러 개의 프로세스 제어 블록을 동시에 꺼내어 준비 상태로 옮긴다. 입출력이 동시에 끝날 경우 여러 개의 인터럽트가 한번에 처리되고 인터럽트 벡터에 있는 정보에 따라 관련 프로세스 제어블록이 준비상태로 이동하는 것이다.

<br/>

## 4. 스케줄링 알고리즘
<br/>

### [스케줄링 알고리즘의 선택 기준]
<br/>

- CPU 사용률 : 전체 시스템 동작 시간 중 CPU가 사용된 시간
- 처리량: 단위 시간당 작업을 마친 프로세스의 수
- 대기 시간 : 프로세스가 생성된 후 실행되기 전까지 시간
- 응답 시간 : 첫 작업을 시작한 후 첫 출력이 나오기까지의 시간
- 반환 시간 : 대기 시간을 포함하여 실행이 종료될 때까지의 시간

<br/>

### [FCFS 스케줄링]
<br/>

- 준비 큐에 도착한 순서대로 CPU를 할당하는 비선점형 방식
- 단순하고 공평하지만 처리 시간이 긴 프로세스가 CPU를 차지하면 다른 프로세스는 계속 기다려야 해서 효율성이 떨어진다 -> 콘보이 효과
- 작업 중인 프로세스가 입출력을 요청하는 경우에도 CPU가 일하지 않고 쉬는 시간이 많아져 작업 효율이 떨어진다.

<br/>

### [SJF 스케줄링]
<br/>

- 준비 큐에 있는 프로세스 중에서 실행 시간이 가장 짧은 작업부터 CPU를 할당하는 비선점형 방식
- 콘보이 효과를 완화할 수 있다는 장점이 있다.
- 운영체제가 프로세스 종료 시간을 정확하게 예측하기 어렵기 때문에 사용이 어렵다.
- 공평성을 위배하는 문제가 있고 스타베이션 현상이 일어날 수 있다. 

<br/>

### [HRN 스케줄링]
<br/>

- 대기 시간과 CPU 사용시간을 모두 고려하여 스케줄링하는 방식
- SFJ의 아사 현상을 완화했지만 여전히 공평성을 위배하기 때문에 많이 사용하지 않는다.

<br/>

### [라운드로빈 스케줄링]
<br/>

- 한 프로세스가 할당받은 시간 동안 작업을 하다가 작업을 완료하지 못하면 준비 큐의 맨 뒤로 가서 자기 차례를 기다리는 선점형 방식이다.
- FCFS와 유사하지만 주어진 타임 슬라이스 동안만 작업할 수 있다는 점이 다르다.
- 타임 슬라이스가 너무 큰 경우에는 FCFS와 다를 바가 없고, 타임 슬라이스가 작은 경우에는 문맥 교환이 너무 자주 발생하여 시스템 전반적인 성능이 떨어진다.

- 유닉스 운영체제에서는 대략 10~200밀리초 사이에서 타임슬라이스를 조정한다.

<br/>

### [SRT 스케줄링]
<br/>

- SFJ 스케줄링과 라운드 로빈 스케줄링을 혼합한 방식이다. 기본적으로 라운드 로빈 스케줄링을 사용하지만, CPU를 할당받을 프로세스를 선택할 때 남은 작업시간이 가장 적은 프로세스를 선택한다. 
- SFJ와 마찬가지로 운영체제가 프로세스 종료 시간을 예측하기 어렵고 아사 현상이 일어나기 때문에 잘 사용하지 않는다.

<br/>

### [우선순위 스케줄링]
<br/>

- 프로세스 중요도에 따라 우선순위를 고려하는 스케줄링으로 이는 비선점형 방식과 선점형 방식에 모두 적용할 수 있다. 
- 공평성 위배, 아사 현상의 문제가 있고 프로세스 순서를 무시하며 우선 순위를 매번 바꿔야 하기 때문에 시스템 효율성을 떨어뜨린다.

<br/>

### [다단계 큐 스케줄링]
<br/>

- 우선 순위에 따라 여러 개의 준비 큐를 사용하는 선점형 방식이다.
- 우선순위가 높은 상위 큐 프로세스의 작업이 끝나기 전에는 하위 큐 프로세스의 작업을 할 수가 없는 문제를 해결하기 위해 다단계 피드백 큐 스케줄링이 제안되었다.

<br/>

### [다단계 피드백 큐 스케줄링]
<br/>

- 기본적으로 다단계 큐 스케줄링과 같은 형태를 사용하지만 CPU를 사용하고 난 프로세스는 우선순위가 낮아져 우선순위가 하나 낮은 큐의 끝으로 들어가는 방식이다.
- 우선순위에 따라 타임 슬라이스의 크기가 다르다. 우선순위가 낮아질수록 타임 슬라이스가 커진다. 어렵게 얻은 CPU를 오랫동안 사용할 수 있도록하기 위함이다.결국 마지막 큐에 있는 프로세스는 무한대의 타임 슬라이스를 얻는다. 
- 오늘날의 운영체제가 일반적으로 사용하는 방식으로 변동 우선순위 알고리즘의 전형적인 예이다. 