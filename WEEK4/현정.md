# 교착상태

## 1. 교착상태의 개요
<br/>
  
  교착상태란 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만을 기다리며 작업을 더 이상 진행하지 못하는 상태를 말한다.  
  다른 프로세스와 공유할 수 없는 자원을 사용하거나 공유 변수를 사용할 때, 여러 프로세스가 같은 응용 프로그램을 사용할 때 교착상태가 발생할 수 있다.

### [자원 할당 그래프]
<br/>

   프로세스가 어떤 자원을 사용하고 있고 어떤 자원을 기다리고 있는지를 표현한 그래프. 교착 상태가 발생했는지 체크하기 위해 사용한다. 
   프로세스는 원, 자원은 사각형으로 표현하고 자원을 사용하고 있는 경우에는 자원으로부터 프로세스로 향하는 화살표를 표시한다. 프로세스가 자원을 기다리고 있는 경우에는 프로세스로부터 자원으로 향하는 화살표를 표시한다. 

<br/>

## 2. 교착상태 필요조건
<br/>

  - 상호배제 : 2개 이상의 프로세스가 동시에 공유할 수 없는 자원이어야 한다.
  - 비선점 : 한 프로세스가 자원을 사용하고 있을 때 다른 프로세스가 빼앗을 수 없다.
  - 점유와 대기 : 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 한다.
  - 원형 대기 : 여러 프로세스가 서로 상대방의 자원을 기다리면서 자기가 가진 자원을 놓지 않고 있어 방향이 원을 이루는 경우여야 한다.

<br/>

## 3. 교착 상태 해결 방법
<br/>
 
  - 예방 : 교착상태를 유발하는 네 가지 조건 중 하나라도 발생하지 않도록 하여 교착 상태를 처리하는 방법이다.
    - 상호 배제 예방 : 시스템 내에 독점적으로 사용할 수 있는 자원을 없애는 방법. 현실성이 없다.
    - 비선점 예방 : 다른 프로세스가 자원을 사용하고 있어도 빼앗을 수 있도록 하는 방법. 상호 배제를 보장할 수 없고, 아사 현상의 가능성이 높다.
    - 점유와 대기 예방 : 프로세스가 사용하려는 자원을 한꺼번에 점유하거나 아니면 모두 반납하는 방법. 추후에 필요한 자원이 생길 수도 있고, 당장 사용하지 않을 자원을 선점하여 낭비가 생기고, 공평하지 못하다는 단점이 있다.
    - 원형 대기 예방 : 모든 자원에 숫자를 부여하고 숫자가 큰 방향으로만 자원을 할당하여 자원을 한 방향으로만 사용하도록 하는 방법. 프로세스 작업 진행에 유연성이 떨어지고, 자원 번호를 부여하는 방법이 모호하다는 단점이 있다. 

    <br/>

  - 회피 : 교착상태를 예상하여 그 수준 이하로만 자원을 할당하는 방법이다. 
    - 은행원 알고리즘 : 안정 상태와 불안정 상태로 나누어 기대 자원(앞으로 사용할 자원의 수)이 가용 자원(시스템 내 현재 사용할 수 있는 자원의 수)보다 크면 자원을 할당하고, 크지 않으면 할당하지 않는다. 프로세스가 자신이 사용할 자원을 미리 선언해야 하고, 할당할 수 있는 상태에서도 불안정 상태로 판단되면 자원을 활용하지 못해 자원이 낭비된다는 단점이 있다.

    <br/>

  - 검출 : 운영체제가 프로세스 작업을 관찰하면서 교착 상태 발생 여부를 계속 주시하는 방법이다.
    - 타임아웃을 이용한 검출 : 일정시간 동안 작업이 진행되지 않은 프로세스를 교착 상태가 발생한 것으로 간주하여 처리하는 방법. 대부분의 운영체제에서 선호하는 방법이다. 엉뚱한 프로세스가 강제 종료될 수 있고, 모든 시스템에 적용할 수 없다는 단점이 있다. 
    - 자원 할당 그래프를 이용한 교착 상태 검출 : 그래프를 유지하고, 갱신하는 등 추가 작업 때문에 오버헤드가 발생하는 단점이 있다. 

    <br/>
  
   - 회복 : 교착 상태 검출 후 교착 상태를 유발한 프로세스를 강제로 종료하여 상태를 회복한다. 교착 상태를 일으킨 모든 프로세스를 동시에 종료하거나 프로세스 중 하나를 골라 순서대로 종료하는 방법을 사용한다. 이후에 강제 종료된 프로세스가 실행되기 전에 시스템을 복구하는 작업도 해야한다. 시스템 복구는 명령어가 실행될 때마다 체크포인트를 만들어 가장 최근의 검사 시점으로 돌아가는 방식으로 한다. 

<br/>

## 4. 다중 자원과 교착 상태 검출
<br/>

  하나의 자원을 하나의 프로세스만 사용할 경우에는 사이클이 있으면 교착 상태로 판단하지만 하나의 자원을 여러 프로세스가 동시에 사용할 수 있는 경우에는 대기 그래프에서 그래프 감소를 완료한 이후에도 사이클이 남아 있다면 교착상태가 발생한 것으로 판단한다. 

* 대기 그래프 : 프로세스와 프로세스 간에 기다리는 관계만 나타낸 그래프
* 그래프 감소 : 대기 그래프에서 작업이 끝날 가능성이 있느느 프로세스의 화살표와 관련 프로세스의 화살표를 연속적으로 지워가는 작업

---



  

